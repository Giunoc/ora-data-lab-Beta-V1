<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ORA! Data Lab - Energia</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        /* --- BRAND VARIABLES --- */
        :root {
            --ora-yellow: #FFD958;
            --ora-black: #000000;
            --ora-white: #FFFFFF;
            --ora-gray: #F5F5F5;
            --ora-success: #90EE90;
            --ora-error: #FFB6B6;
        }

        /* --- RESET & BASE STYLES --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Montserrat', sans-serif; color: var(--ora-black); background-color: var(--ora-white); line-height: 1.6; display: flex; flex-direction: column; min-height: 100vh; }

        /* --- UTILITIES --- */
        .container { max-width: 1200px; margin: 0 auto; padding: 40px 20px; width: 100%; }
        .section { margin-bottom: 80px; }
        .section-title { font-size: 2rem; font-weight: 700; margin-bottom: 30px; text-align: center; text-transform: uppercase; }
        .hidden { display: none !important; }
        
        /* Buttons */
        .btn { background-color: var(--ora-yellow); color: var(--ora-black); border: 2px solid var(--ora-black); padding: 12px 30px; font-weight: 700; text-transform: uppercase; cursor: pointer; border-radius: 4px; transition: all 0.2s; display: inline-block; font-size: 1rem; }
        .btn:hover { background-color: var(--ora-black); color: var(--ora-white); transform: translateY(-2px); box-shadow: 4px 4px 0 var(--ora-black); }
        .btn-secondary { background-color: var(--ora-black); color: var(--ora-white); }
        .btn-secondary:hover { background-color: var(--ora-yellow); color: var(--ora-black); }

        /* --- NAVIGATION --- */
        .navbar { background-color: var(--ora-black); padding: 15px 0; color: var(--ora-white); position: sticky; top: 0; z-index: 100; }
        .navbar .container { padding: 0 20px; margin: 0 auto; display: flex; align-items: center; } 
        .navbar a { color: var(--ora-yellow); text-decoration: none; font-weight: 700; text-transform: uppercase; font-size: 0.9rem; }
        .navbar a:hover { text-decoration: underline; }

        /* --- HERO --- */
        .hero { background-color: var(--ora-yellow); color: var(--ora-black); padding: 80px 20px; text-align: center; border-bottom: 3px solid var(--ora-black); }
        .hero h1 { font-size: 2.5rem; font-weight: 700; margin-bottom: 20px; text-transform: uppercase; letter-spacing: -1px; }
        .hero p { font-size: 1.2rem; max-width: 800px; margin: 0 auto; font-weight: 500; }

        /* --- QUIZ --- */
        .quiz-container { background-color: var(--ora-gray); padding: 50px 0; border-bottom: 2px solid var(--ora-black); }
        .question-card { background-color: var(--ora-white); border: 2px solid var(--ora-black); border-radius: 8px; padding: 30px; margin: 20px auto; max-width: 800px; box-shadow: 6px 6px 0 var(--ora-black); }
        .question-text { font-size: 1.4rem; font-weight: 600; margin-bottom: 25px; line-height: 1.4; }
        .option { background-color: var(--ora-white); border: 2px solid var(--ora-black); padding: 15px 20px; margin: 12px 0; border-radius: 4px; cursor: pointer; transition: all 0.2s; font-weight: 500; font-size: 1.1rem; }
        .option:hover { background-color: var(--ora-yellow); transform: translateX(5px); }
        .option.selected { background-color: var(--ora-yellow); font-weight: 700; border-width: 3px; }
        .option.correct { background-color: var(--ora-success); border-color: #006400; }
        .option.incorrect { background-color: var(--ora-error); border-color: #8B0000; }
        .feedback { margin-top: 25px; padding: 20px; border: 2px solid var(--ora-black); border-radius: 4px; animation: fadeIn 0.3s ease-in; }
        .feedback.correct { background-color: var(--ora-success); }
        .feedback.incorrect { background-color: var(--ora-error); }
        .results-summary { text-align: center; padding: 20px; }
        .results-summary .score { font-size: 5rem; font-weight: 700; color: var(--ora-yellow); -webkit-text-stroke: 2px var(--ora-black); margin: 20px 0; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- SIMULATOR & CHARTS --- */
        .card { background-color: var(--ora-white); border: 2px solid var(--ora-black); border-radius: 8px; padding: 30px; box-shadow: 6px 6px 0 var(--ora-black); }
        .slider-container { margin: 30px 0; }
        .slider-label { display: flex; justify-content: space-between; margin-bottom: 12px; font-weight: 700; font-size: 1.1rem; }
        .slider { width: 100%; height: 10px; border-radius: 5px; background: var(--ora-gray); outline: none; border: 2px solid var(--ora-black); appearance: none; }
        .slider::-webkit-slider-thumb { appearance: none; width: 28px; height: 28px; border-radius: 50%; background: var(--ora-yellow); border: 2px solid var(--ora-black); cursor: pointer; transition: transform 0.1s; }
        .slider::-webkit-slider-thumb:hover { transform: scale(1.1); }
        .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin: 40px 0; }
        .metric-card { background-color: var(--ora-gray); border: 2px solid var(--ora-black); padding: 25px; text-align: center; border-radius: 4px; }
        .metric-value { font-size: 2.8rem; font-weight: 700; line-height: 1; }
        .metric-label { font-size: 0.9rem; font-weight: 600; margin-top: 15px; text-transform: uppercase; letter-spacing: 1px; }
        .chart-container { position: relative; margin: 30px 0; height: 450px; width: 100%; }

        /* --- FOOTER --- */
        .footer { background-color: var(--ora-black); color: var(--ora-white); padding: 60px 20px; text-align: center; margin-top: auto; border-top: 5px solid var(--ora-yellow); }

        /* --- RESPONSIVE --- */
        @media (max-width: 768px) {
            .hero h1 { font-size: 2rem; }
            .metrics-grid { grid-template-columns: 1fr; }
            .chart-container { height: 300px; }
            .container { padding: 30px 15px; }
        }
    </style>
</head>
<body>
    
    <nav class="navbar">
        <div class="container">
            <a href="index.html">← Torna alla Home</a>
            <span style="margin-left: auto; opacity: 0.7;">ORA! Data Lab</span>
        </div>
    </nav>

    <header class="hero">
        <div class="container">
            <h1>Energia: Transizione e Sostenibilità</h1>
            <p>L'Italia è al bivio tra sicurezza energetica e obiettivi climatici. <br>Comprendi il mix energetico nazionale e il vero costo della decarbonizzazione.</p>
        </div>
    </header>

    <section class="quiz-container" id="quizSection">
        <div class="container">
            <h2 class="section-title">Step 1: Sfida le tue Convinzioni</h2>
            <div id="quizProgress" style="text-align: center; font-weight: 600; margin-bottom: 10px;">Caricamento...</div>
            <div id="scoreDisplay" style="text-align: center; margin-bottom: 20px;"></div>
            <div id="quizContent"></div>
            <div style="display: flex; justify-content: center; gap: 20px; margin-top: 30px;">
                <button class="btn hidden" id="prevBtn" onclick="previousQuestion()">← Precedente</button>
                <button class="btn" id="nextBtn" onclick="nextQuestion()">Inizia Quiz</button>
                <button class="btn btn-secondary hidden" id="restartBtn" onclick="restartQuiz()">Ricomincia</button>
            </div>
        </div>
    </section>

    <section class="container section">
        <h2 class="section-title">Step 2: Progetta il Mix Energetico del Futuro</h2>
        <div class="card">
            <p style="text-align: center; margin-bottom: 30px;">
                Modifica le quote di produzione per raggiungere il 100% dell'energia richiesta. 
                Osserva l'impatto su emissioni di CO2 e indice di costo.
            </p>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px;">
                <!-- Left Column: Sliders -->
                <div>
                    <h3 style="margin-bottom: 20px;">Leve di Composizione (%)</h3>
                    <div class="slider-container">
                        <div class="slider-label"><span>Solare & Eolico</span><span id="solar_windValue">20.0%</span></div>
                        <input type="range" min="0" max="70" value="20" step="0.1" class="slider" id="solar_windSlider">
                    </div>
                    <div class="slider-container">
                        <div class="slider-label"><span>Nucleare</span><span id="nuclearValue">0.0%</span></div>
                        <input type="range" min="0" max="40" value="0" step="0.1" class="slider" id="nuclearSlider">
                    </div>
                    <div class="slider-container">
                        <div class="slider-label"><span>Gas Naturale</span><span id="gasValue">45.0%</span></div>
                        <input type="range" min="0" max="90" value="45" step="0.1" class="slider" id="gasSlider">
                    </div>
                    <div class="slider-container">
                        <div class="slider-label"><span>Petrolio & Carbone</span><span id="oil_coalValue">15.0%</span></div>
                        <input type="range" min="0" max="60" value="15" step="0.1" class="slider" id="oil_coalSlider">
                    </div>
                    <p style="margin-top: 20px; font-style: italic;">
                        Le quote Idroelettrico (10.0%) e Altro (10.0%) sono mantenute fisse.
                    </p>
                </div>

                <!-- Right Column: Chart and Metrics -->
                <div>
                    <h3 style="margin-bottom: 20px;">Mix Attuale e Risultati</h3>
                    <div style="height: 350px;">
                        <canvas id="mixChart"></canvas>
                    </div>
                    <div class="metrics-grid" style="margin-top: 20px;">
                        <div class="metric-card">
                            <div class="metric-value" id="co2EmissionsValue">250.0 Mt CO2e</div>
                            <div class="metric-label">Emissioni (Rapporto)</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="costIndexValue" style="color: var(--ora-black);">100</div>
                            <div class="metric-label">Indice di Costo Energetico (Base=100)</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 40px;">
                <button class="btn btn-secondary" onclick="resetDecarbSimulator()">Ripristina Mix Base (2024)</button>
            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <p><strong>ORA! Data Lab</strong> - Energy Module v2.0</p>
            <p style="font-size: 0.9rem; margin-top: 10px; opacity: 0.8;">
                Dati elaborati da fonti ufficiali: IEA, Terna, ARERA, Eurostat.
            </p>
            <p style="font-size: 0.9rem; margin-top: 5px; opacity: 0.8;">
                &copy; 2025 ORA! Partito Politico.
            </p>
        </div>
    </footer>

    <!-- JAVASCRIPT LOGIC -->
    <script>
    /**
     * ORA! Data Lab - Energy Logic
     */
    const energyData = {
        base_mix: { gas: 45, oil_coal: 15, hydro: 10, solar_wind: 20, nuclear: 0, other: 10 },
        factors: { gas: { co2: 5.5, cost: 1.0 }, oil_coal: { co2: 7.0, cost: 1.2 }, hydro: { co2: 0.1, cost: 0.8 }, solar_wind: { co2: 0.2, cost: 0.9 }, nuclear: { co2: 0.1, cost: 1.1 }, other: { co2: 2.0, cost: 1.0 } },
        quiz: [
            { question: "Qual è la fonte energetica primaria usata in Italia per produrre elettricità?", options: ["Idroelettrico", "Gas Naturale", "Carbone", "Nucleare (importato)"], correct: 1, explanation: "Il Gas Naturale (circa 45% del mix) è la nostra fonte primaria." },
            { question: "L'Italia è al momento autosufficiente nella produzione di gas naturale?", options: ["Sì, al 100%", "No, importiamo oltre il 90%", "No, importiamo circa il 50%"], correct: 1, explanation: "No. L'Italia importa oltre il 90% del gas consumato." },
            { question: "Quale fonte ha il minor impatto di emissioni CO2?", options: ["Gas Naturale", "Petrolio", "Nucleare ed Eolico", "Biomasse"], correct: 2, explanation: "Nucleare, Eolico e Solare hanno le emissioni più basse per kWh prodotto." }
        ]
    };

    let currentMix = { ...energyData.base_mix };
    let mixChart = null;

    function initEnergyMixSimulator() {
        createEnergyMixChart('mixChart', currentMix);
        ['solar_wind', 'nuclear', 'gas', 'oil_coal'].forEach(source => {
            const slider = document.getElementById(`${source}Slider`);
            if (slider) slider.addEventListener('input', updateEnergyMix);
        });
        updateEnergyMix();
    }

    function updateEnergyMix(event) {
        if (event) {
            const source = event.target.id.replace('Slider', '');
            let newValue = parseFloat(event.target.value);
            let controlledSources = ['solar_wind', 'nuclear', 'gas', 'oil_coal'];
            const fixedTotal = energyData.base_mix.hydro + energyData.base_mix.other;
            const maxControlled = 100 - fixedTotal;
            
            currentMix[source] = newValue;
            let currentControlledTotal = controlledSources.reduce((sum, key) => sum + currentMix[key], 0);
            let difference = currentControlledTotal - maxControlled;

            if (difference > 0) {
                const reductionPriority = ['oil_coal', 'gas', 'nuclear', 'solar_wind'];
                for (let key of reductionPriority) {
                    if (key !== source && difference > 0) {
                        if (currentMix[key] >= difference) { currentMix[key] -= difference; difference = 0; }
                        else { difference -= currentMix[key]; currentMix[key] = 0; }
                    }
                }
                if (difference > 0) currentMix[source] -= difference;
            } else if (difference < 0) {
                currentMix['gas'] += Math.abs(difference);
            }

            controlledSources.forEach(key => {
                const slider = document.getElementById(`${key}Slider`);
                if (slider) slider.value = currentMix[key].toFixed(1);
            });
        }
        
        currentMix.hydro = energyData.base_mix.hydro;
        currentMix.other = energyData.base_mix.other;

        let totalCO2 = 0;
        let totalCostIndex = 0;
        for (const source in currentMix) {
            totalCO2 += currentMix[source] * energyData.factors[source].co2;
            totalCostIndex += currentMix[source] * energyData.factors[source].cost;
        }
        
        const normalizedCO2 = totalCO2; 
        const normalizedCost = totalCostIndex;
        
        document.getElementById('co2EmissionsValue').textContent = normalizedCO2.toFixed(1) + ' Mt CO2e';
        document.getElementById('costIndexValue').textContent = normalizedCost.toFixed(0);

        const costElement = document.getElementById('costIndexValue');
        let costColor = 'var(--ora-black)';
        if (normalizedCost > 115) costColor = '#FF0000'; else if (normalizedCost < 95) costColor = '#006400';
        costElement.style.color = costColor;
        
        updateEnergyMixChart(currentMix);
        
        for (const key in currentMix) {
            const valueSpan = document.getElementById(`${key}Value`);
            if (valueSpan) valueSpan.textContent = currentMix[key].toFixed(1) + '%';
        }
    }

    function createEnergyMixChart(canvasId, initialMix) {
        const ctx = document.getElementById(canvasId);
        if (!ctx) return;
        if (mixChart) mixChart.destroy();
        
        const labels = { gas: 'Gas Naturale', oil_coal: 'Petrolio & Carbone', hydro: 'Idroelettrico', solar_wind: 'Solare & Eolico', nuclear: 'Nucleare', other: 'Altro/Import' };
        const colors = { gas: '#FFA500', oil_coal: '#333333', hydro: '#00BFFF', solar_wind: '#32CD32', nuclear: '#4169E1', other: '#D3D3D3' };

        mixChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: Object.keys(initialMix).map(key => labels[key]),
                datasets: [{
                    data: Object.values(initialMix),
                    backgroundColor: Object.keys(initialMix).map(key => colors[key]),
                    borderColor: '#ffffff',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { position: 'bottom' }, tooltip: { callbacks: { label: (c) => c.label + ': ' + c.parsed.toFixed(1) + '%' } } }
            }
        });
    }

    function updateEnergyMixChart(newMix) {
        if (mixChart) { mixChart.data.datasets[0].data = Object.values(newMix); mixChart.update(); }
    }

    function resetDecarbSimulator() {
        currentMix = { ...energyData.base_mix };
        document.getElementById('solar_windSlider').value = energyData.base_mix.solar_wind;
        document.getElementById('nuclearSlider').value = energyData.base_mix.nuclear;
        document.getElementById('gasSlider').value = energyData.base_mix.gas;
        document.getElementById('oil_coalSlider').value = energyData.base_mix.oil_coal;
        updateEnergyMix({ target: { id: 'dummy', value: 0 } });
    }

    // --- QUIZ LOGIC ---
    const quizEngine = { currentQuestion: 0, score: 0, answeredQuestions: 0, selectedAnswers: new Array(energyData.quiz.length).fill(null) };

    function initQuiz() { renderQuestion(); }

    function renderQuestion() {
        const quizContent = document.getElementById('quizContent');
        if (!quizContent) return;
        const question = energyData.quiz[quizEngine.currentQuestion];
        const isAnswered = quizEngine.selectedAnswers[quizEngine.currentQuestion] !== null;
        
        document.getElementById('quizProgress').textContent = `Domanda ${quizEngine.currentQuestion + 1} di ${energyData.quiz.length}`;
        document.getElementById('scoreDisplay').textContent = `Punteggio: ${quizEngine.score}/${quizEngine.answeredQuestions}`;
        
        let html = `<div class="question-card"><div class="question-text">${question.question}</div><div class="options">`;
        question.options.forEach((option, index) => {
            let optionClass = 'option';
            if (isAnswered) {
                if (index === question.correct) optionClass += ' correct';
                else if (index === quizEngine.selectedAnswers[quizEngine.currentQuestion] && index !== question.correct) optionClass += ' incorrect';
            } else if (quizEngine.selectedAnswers[quizEngine.currentQuestion] === index) optionClass += ' selected';
            html += `<div class="${optionClass}" onclick="${isAnswered ? '' : `selectAnswer(${index})`}">${option}</div>`;
        });
        html += '</div>';
        
        if (isAnswered) {
            const isCorrect = quizEngine.selectedAnswers[quizEngine.currentQuestion] === question.correct;
            html += `<div class="feedback ${isCorrect ? 'correct' : 'incorrect'}"><strong>${isCorrect ? '✓ Corretto!' : '✗ Sbagliato.'}</strong><p>${question.explanation}</p></div>`;
        }
        html += '</div>'; 
        quizContent.innerHTML = html;
        document.getElementById('prevBtn').classList.toggle('hidden', quizEngine.currentQuestion === 0);
        document.getElementById('nextBtn').textContent = quizEngine.currentQuestion === energyData.quiz.length - 1 ? 'Vedi Risultati' : 'Successiva →';
        document.getElementById('nextBtn').classList.remove('hidden');
        document.getElementById('restartBtn').classList.add('hidden');
    }

    function selectAnswer(index) {
        if (quizEngine.selectedAnswers[quizEngine.currentQuestion] !== null) return;
        quizEngine.selectedAnswers[quizEngine.currentQuestion] = index;
        if (index === energyData.quiz[quizEngine.currentQuestion].correct) quizEngine.score++;
        quizEngine.answeredQuestions++;
        renderQuestion();
    }
    function nextQuestion() {
        if (quizEngine.selectedAnswers[quizEngine.currentQuestion] === null) return alert('Seleziona una risposta.');
        if (quizEngine.currentQuestion < energyData.quiz.length - 1) { quizEngine.currentQuestion++; renderQuestion(); } 
        else showResults();
    }
    function previousQuestion() {
        if (quizEngine.currentQuestion > 0) { quizEngine.currentQuestion--; renderQuestion(); }
    }
    function showResults() {
        const quizContent = document.getElementById('quizContent');
        const percentage = Math.round((quizEngine.score / energyData.quiz.length) * 100);
        quizContent.innerHTML = `<div class="results-summary"><h2>Risultati</h2><div class="score">${percentage}%</div><p>Risposte corrette: ${quizEngine.score}/${energyData.quiz.length}</p></div>`;
        document.getElementById('prevBtn').classList.add('hidden');
        document.getElementById('nextBtn').classList.add('hidden');
        document.getElementById('restartBtn').classList.remove('hidden');
    }
    function restartQuiz() {
        quizEngine.currentQuestion = 0; quizEngine.score = 0; quizEngine.answeredQuestions = 0; quizEngine.selectedAnswers.fill(null);
        renderQuestion();
    }

    // --- INIT ---
    document.addEventListener('DOMContentLoaded', function() {
        initQuiz();
        initEnergyMixSimulator();
    });
    </script>
</body>
</html>
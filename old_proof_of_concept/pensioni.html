<!doctype html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ORA! Data Lab - Pensioni</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
      /* --- BRAND VARIABLES --- */
      :root {
        --ora-yellow: #ffd958;
        --ora-black: #000000;
        --ora-white: #ffffff;
        --ora-gray: #f5f5f5;
        --ora-success: #90ee90;
        --ora-error: #ffb6b6;
      }

      /* --- RESET & BASE STYLES --- */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: "Montserrat", sans-serif;
        color: var(--ora-black);
        background-color: var(--ora-white);
        line-height: 1.6;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      /* --- UTILITIES --- */
      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 40px 20px;
        width: 100%;
      }
      .section {
        margin-bottom: 80px;
      }
      .section-title {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 30px;
        text-align: center;
        text-transform: uppercase;
      }
      .hidden {
        display: none !important;
      }

      /* Buttons */
      .btn {
        background-color: var(--ora-yellow);
        color: var(--ora-black);
        border: 2px solid var(--ora-black);
        padding: 12px 30px;
        font-weight: 700;
        text-transform: uppercase;
        cursor: pointer;
        border-radius: 4px;
        transition: all 0.2s;
        display: inline-block;
        font-size: 1rem;
      }
      .btn:hover {
        background-color: var(--ora-black);
        color: var(--ora-white);
        transform: translateY(-2px);
        box-shadow: 4px 4px 0 var(--ora-black);
      }
      .btn-secondary {
        background-color: var(--ora-black);
        color: var(--ora-white);
      }
      .btn-secondary:hover {
        background-color: var(--ora-yellow);
        color: var(--ora-black);
      }

      /* --- NAVIGATION --- */
      .navbar {
        background-color: var(--ora-black);
        padding: 15px 0;
        color: var(--ora-white);
        position: sticky;
        top: 0;
        z-index: 100;
      }
      .navbar .container {
        padding: 0 20px;
        margin: 0 auto;
        display: flex;
        align-items: center;
      }
      .navbar a {
        color: var(--ora-yellow);
        text-decoration: none;
        font-weight: 700;
        text-transform: uppercase;
        font-size: 0.9rem;
      }
      .navbar a:hover {
        text-decoration: underline;
      }

      /* --- HERO --- */
      .hero {
        background-color: var(--ora-yellow);
        color: var(--ora-black);
        padding: 80px 20px;
        text-align: center;
        border-bottom: 3px solid var(--ora-black);
      }
      .hero h1 {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 20px;
        text-transform: uppercase;
        letter-spacing: -1px;
      }
      .hero p {
        font-size: 1.2rem;
        max-width: 800px;
        margin: 0 auto;
        font-weight: 500;
      }

      /* --- QUIZ --- */
      .quiz-container {
        background-color: var(--ora-gray);
        padding: 50px 0;
        border-bottom: 2px solid var(--ora-black);
      }
      .question-card {
        background-color: var(--ora-white);
        border: 2px solid var(--ora-black);
        border-radius: 8px;
        padding: 30px;
        margin: 20px auto;
        max-width: 800px;
        box-shadow: 6px 6px 0 var(--ora-black);
      }
      .question-text {
        font-size: 1.4rem;
        font-weight: 600;
        margin-bottom: 25px;
        line-height: 1.4;
      }
      .option {
        background-color: var(--ora-white);
        border: 2px solid var(--ora-black);
        padding: 15px 20px;
        margin: 12px 0;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.2s;
        font-weight: 500;
        font-size: 1.1rem;
      }
      .option:hover {
        background-color: var(--ora-yellow);
        transform: translateX(5px);
      }
      .option.selected {
        background-color: var(--ora-yellow);
        font-weight: 700;
        border-width: 3px;
      }
      .option.correct {
        background-color: var(--ora-success);
        border-color: #006400;
      }
      .option.incorrect {
        background-color: var(--ora-error);
        border-color: #8b0000;
      }
      .feedback {
        margin-top: 25px;
        padding: 20px;
        border: 2px solid var(--ora-black);
        border-radius: 4px;
        animation: fadeIn 0.3s ease-in;
      }
      .feedback.correct {
        background-color: var(--ora-success);
      }
      .feedback.incorrect {
        background-color: var(--ora-error);
      }
      .results-summary {
        text-align: center;
        padding: 20px;
      }
      .results-summary .score {
        font-size: 5rem;
        font-weight: 700;
        color: var(--ora-yellow);
        -webkit-text-stroke: 2px var(--ora-black);
        margin: 20px 0;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* --- SIMULATOR & CHARTS --- */
      .card {
        background-color: var(--ora-white);
        border: 2px solid var(--ora-black);
        border-radius: 8px;
        padding: 30px;
        box-shadow: 6px 6px 0 var(--ora-black);
      }
      .slider-container {
        margin: 30px 0;
      }
      .slider-label {
        display: flex;
        justify-content: space-between;
        margin-bottom: 12px;
        font-weight: 700;
        font-size: 1.1rem;
      }
      .slider {
        width: 100%;
        height: 10px;
        border-radius: 5px;
        background: var(--ora-gray);
        outline: none;
        border: 2px solid var(--ora-black);
        appearance: none;
      }
      .slider::-webkit-slider-thumb {
        appearance: none;
        width: 28px;
        height: 28px;
        border-radius: 50%;
        background: var(--ora-yellow);
        border: 2px solid var(--ora-black);
        cursor: pointer;
        transition: transform 0.1s;
      }
      .slider::-webkit-slider-thumb:hover {
        transform: scale(1.1);
      }
      .metrics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 20px;
        margin: 40px 0;
      }
      .metric-card {
        background-color: var(--ora-gray);
        border: 2px solid var(--ora-black);
        padding: 25px;
        text-align: center;
        border-radius: 4px;
      }
      .metric-value {
        font-size: 2.8rem;
        font-weight: 700;
        line-height: 1;
      }
      .metric-label {
        font-size: 0.9rem;
        font-weight: 600;
        margin-top: 15px;
        text-transform: uppercase;
        letter-spacing: 1px;
      }
      .sustainability-gauge {
        max-width: 350px;
        margin: 30px auto;
        position: relative;
      }
      .chart-container {
        position: relative;
        margin: 30px 0;
        height: 450px;
        width: 100%;
      }
      .pyramid-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 40px;
        margin: 30px 0;
      }
      .pyramid-chart {
        background-color: var(--ora-white);
        border: 2px solid var(--ora-black);
        border-radius: 8px;
        padding: 20px;
      }
      .pyramid-title {
        text-align: center;
        font-weight: 700;
        margin-bottom: 15px;
        font-size: 1.2rem;
        background: var(--ora-yellow);
        display: inline-block;
        padding: 5px 15px;
        border: 2px solid var(--ora-black);
        border-radius: 20px;
      }

      /* --- FOOTER --- */
      .footer {
        background-color: var(--ora-black);
        color: var(--ora-white);
        padding: 60px 20px;
        text-align: center;
        margin-top: auto;
        border-top: 5px solid var(--ora-yellow);
      }

      /* --- RESPONSIVE --- */
      @media (max-width: 768px) {
        .hero h1 {
          font-size: 2rem;
        }
        .topic-grid,
        .pyramid-container,
        .metrics-grid {
          grid-template-columns: 1fr;
        }
        .chart-container {
          height: 300px;
        }
        .question-text {
          font-size: 1.2rem;
        }
        .container {
          padding: 30px 15px;
        }
      }
    </style>
  </head>
  <body>
    <!-- 1. NAVIGATION -->
    <nav class="navbar">
      <div class="container">
        <a href="index.html">← Torna alla Home</a>
        <span style="margin-left: auto; opacity: 0.7">ORA! Data Lab</span>
      </div>
    </nav>

    <!-- 2. HERO -->
    <header class="hero">
      <div class="container">
        <h1>Pensioni: La Verità dei Dati</h1>
        <p>
          Il sistema pensionistico italiano è spesso al centro del dibattito
          politico. <br />Ma quanto ne sai davvero? Scoprilo con i dati
          ufficiali ISTAT e RGS.
        </p>
      </div>
    </header>

    <!-- 3. QUIZ SECTION -->
    <section class="quiz-container" id="quizSection">
      <div class="container">
        <h2 class="section-title">Step 1: Sfida le tue Convinzioni</h2>
        <div
          id="quizProgress"
          style="text-align: center; font-weight: 600; margin-bottom: 10px"
        >
          Caricamento...
        </div>
        <div
          id="scoreDisplay"
          style="text-align: center; margin-bottom: 20px"
        ></div>

        <div id="quizContent"></div>

        <div
          style="
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
          "
        >
          <button class="btn hidden" id="prevBtn" onclick="previousQuestion()">
            ← Precedente
          </button>
          <button class="btn" id="nextBtn" onclick="nextQuestion()">
            Inizia Quiz
          </button>
          <button
            class="btn btn-secondary hidden"
            id="restartBtn"
            onclick="restartQuiz()"
          >
            Ricomincia
          </button>
        </div>
      </div>
    </section>

    <!-- 4. SIMULATOR SECTION -->
    <section class="section container">
      <h2 class="section-title">Step 2: Simulatore di Sostenibilità</h2>
      <div class="card">
        <p style="text-align: center; margin-bottom: 30px">
          Il sistema si regge su un equilibrio precario.
          <strong>Sposta i cursori</strong> per vedere come occupazione,
          produttività e demografia influenzano il futuro.
        </p>

        <!-- Sliders -->
        <div class="slider-container">
          <div class="slider-label">
            <span>Tasso di Occupazione</span
            ><span id="employmentValue">61.5%</span>
          </div>
          <input
            type="range"
            min="50"
            max="80"
            value="61.5"
            step="0.5"
            class="slider"
            id="employmentSlider"
          />
          <small
            >Media UE: 70%. Se lavorano più persone, ci sono più
            contributi.</small
          >
        </div>

        <div class="slider-container">
          <div class="slider-label">
            <span>Produttività Annua</span
            ><span id="productivityValue">0.5%</span>
          </div>
          <input
            type="range"
            min="0"
            max="3"
            value="0.5"
            step="0.1"
            class="slider"
            id="productivitySlider"
          />
          <small>Se il PIL cresce, il debito pesa meno.</small>
        </div>

        <div class="slider-container">
          <div class="slider-label">
            <span>Età Pensionamento</span
            ><span id="retirementValue">67 anni</span>
          </div>
          <input
            type="range"
            min="62"
            max="72"
            value="67"
            step="1"
            class="slider"
            id="retirementSlider"
          />
          <small
            >Alzare l'età riduce la spesa, ma è socialmente sostenibile?</small
          >
        </div>

        <div class="slider-container">
          <div class="slider-label">
            <span>Tasso di Fertilità</span><span id="fertilityValue">1.24</span>
          </div>
          <input
            type="range"
            min="1.0"
            max="2.1"
            value="1.24"
            step="0.01"
            class="slider"
            id="fertilitySlider"
          />
          <small
            >Figli per donna. Necessario 2.1 per stabilità demografica.</small
          >
        </div>

        <!-- Dashboard Output -->
        <div class="metrics-grid">
          <div class="metric-card">
            <div class="metric-value" id="sustainabilityRatio">1.43</div>
            <div class="metric-label">Lavoratori per Pensionato</div>
          </div>
          <div class="metric-card">
            <div class="metric-value" id="spendingPct">16.2%</div>
            <div class="metric-label">Spesa su PIL</div>
          </div>
          <div class="metric-card">
            <div class="metric-value" id="systemHealth" style="color: red">
              CRITICO
            </div>
            <div class="metric-label">Stato Salute</div>
          </div>
        </div>

        <div class="sustainability-gauge">
          <canvas id="gaugeChart"></canvas>
        </div>

        <div style="text-align: center">
          <button class="btn btn-secondary" onclick="resetSustainability()">
            Ripristina Valori
          </button>
        </div>
      </div>
    </section>

    <!-- 5. CHARTS SECTION -->
    <section class="section container">
      <h2 class="section-title">Step 3: Il Contesto (Dati Reali)</h2>

      <!-- Demographics -->
      <div class="card" style="margin-bottom: 40px">
        <h3 style="text-align: center; margin-bottom: 20px">
          L'Inverno Demografico (2024 vs 2070)
        </h3>
        <p style="text-align: center; margin-bottom: 20px">
          Confronta la struttura della popolazione oggi e tra 50 anni.
        </p>

        <div class="pyramid-container">
          <div class="pyramid-chart">
            <div style="text-align: center">
              <span class="pyramid-title">2024</span>
            </div>
            <div style="height: 300px">
              <canvas id="pyramid2024"></canvas>
            </div>
          </div>
          <div class="pyramid-chart">
            <div style="text-align: center">
              <span class="pyramid-title">2070</span>
            </div>
            <div style="height: 300px">
              <canvas id="pyramid2070"></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- Projections -->
      <div class="card">
        <h3 style="text-align: center; margin-bottom: 20px">
          Proiezioni di Spesa (Scenari RGS)
        </h3>
        <p style="text-align: center; margin-bottom: 20px">
          La "gobba" della spesa raggiungerà il picco nel 2045.
        </p>
        <div class="chart-container">
          <canvas id="projectionsChart"></canvas>
        </div>
      </div>
    </section>

    <!-- 6. FOOTER -->
    <footer class="footer">
      <div class="container">
        <p><strong>ORA! Data Lab</strong> - Beta Release v1.0</p>
        <p style="font-size: 0.9rem; margin-top: 10px; opacity: 0.8">
          Dati elaborati da fonti ufficiali: ISTAT, Ragioneria Generale dello
          Stato, Eurostat.
        </p>
        <p style="font-size: 0.9rem; margin-top: 5px; opacity: 0.8">
          &copy; 2025 ORA! Partito Politico.
        </p>
      </div>
    </footer>

    <!-- JAVASCRIPT LOGIC -->
    <script>
      /**
       * ORA! Data Lab - Pension Logic
       */

      // --- 1. DATASETS ---
      const pensionData = {
        spending_projections: {
          years: [2024, 2030, 2035, 2040, 2045, 2050, 2055, 2060, 2065, 2070],
          rgs_scenario: [
            16.2, 16.5, 16.8, 17.2, 17.5, 17.3, 16.8, 16.2, 15.5, 14.8,
          ],
          awg_scenario: [
            16.2, 16.7, 17.1, 17.6, 18.0, 17.8, 17.2, 16.5, 15.8, 15.0,
          ],
          optimistic_scenario: [
            16.2, 16.0, 15.8, 15.5, 15.2, 14.8, 14.3, 13.8, 13.3, 12.8,
          ],
        },
        demographic_pyramid_2024: {
          age_groups: [
            "0-4",
            "5-9",
            "10-14",
            "15-19",
            "20-24",
            "25-29",
            "30-34",
            "35-39",
            "40-44",
            "45-49",
            "50-54",
            "55-59",
            "60-64",
            "65-69",
            "70-74",
            "75-79",
            "80-84",
            "85+",
          ],
          males: [
            1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 1.9, 2.1, 2.3, 2.4, 2.5, 2.3, 2.1,
            1.9, 1.6, 1.3, 0.9, 0.7,
          ],
          females: [
            1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.8, 2.0, 2.2, 2.3, 2.4, 2.2, 2.0,
            1.8, 1.7, 1.5, 1.2, 1.1,
          ],
        },
        demographic_pyramid_2070: {
          age_groups: [
            "0-4",
            "5-9",
            "10-14",
            "15-19",
            "20-24",
            "25-29",
            "30-34",
            "35-39",
            "40-44",
            "45-49",
            "50-54",
            "55-59",
            "60-64",
            "65-69",
            "70-74",
            "75-79",
            "80-84",
            "85+",
          ],
          males: [
            1.0, 1.0, 1.1, 1.1, 1.2, 1.2, 1.3, 1.3, 1.4, 1.4, 1.5, 1.6, 1.7,
            1.8, 1.9, 1.8, 1.5, 1.3,
          ],
          females: [
            0.9, 0.9, 1.0, 1.0, 1.1, 1.1, 1.2, 1.2, 1.3, 1.3, 1.4, 1.5, 1.6,
            1.7, 1.9, 2.0, 1.9, 1.8,
          ],
        },
      };

      const quizQuestions = [
        {
          question:
            "Quale percentuale del PIL italiano è dedicata oggi alla spesa pensionistica?",
          options: ["Circa 10%", "Circa 16.2%", "Circa 22%", "Circa 28%"],
          correct: 1,
          explanation:
            "Esatto (o quasi). La spesa è al 16,2% del PIL (2024), una delle più alte in Europa.",
        },
        {
          question:
            "Quando raggiungerà il picco massimo la spesa pensionistica?",
          options: ["2030", "2045", "2060", "Mai, scenderà sempre"],
          correct: 1,
          explanation:
            "Corretto. Il picco è previsto intorno al 2045 (circa 17.5% PIL) a causa del pensionamento dei Baby Boomers.",
        },
        {
          question:
            "Qual è l'età media *effettiva* di pensionamento in Italia?",
          options: ["62,5 anni", "64,8 anni", "67,0 anni", "69,2 anni"],
          correct: 1,
          explanation:
            "Giusto. L'età legale è 67 anni, ma quella effettiva è 64,8 a causa di uscite anticipate (es. Quota 103).",
        },
      ];

      // --- 2. QUIZ ENGINE ---
      let currentQuestion = 0;
      let score = 0;
      let answeredQuestions = 0;
      let selectedAnswers = new Array(quizQuestions.length).fill(null);

      function initQuiz() {
        renderQuestion();
      }

      function renderQuestion() {
        const quizContent = document.getElementById("quizContent");
        if (!quizContent) return;
        const question = quizQuestions[currentQuestion];
        const isAnswered = selectedAnswers[currentQuestion] !== null;

        document.getElementById("quizProgress").textContent =
          `Domanda ${currentQuestion + 1} di ${quizQuestions.length}`;
        document.getElementById("scoreDisplay").textContent =
          `Punteggio: ${score}/${answeredQuestions}`;

        let html = `<div class="question-card"><div class="question-text">${question.question}</div><div class="options">`;
        question.options.forEach((option, index) => {
          let optionClass = "option";
          if (isAnswered) {
            if (index === question.correct) optionClass += " correct";
            else if (
              index === selectedAnswers[currentQuestion] &&
              index !== question.correct
            )
              optionClass += " incorrect";
          } else if (selectedAnswers[currentQuestion] === index)
            optionClass += " selected";
          html += `<div class="${optionClass}" tabindex="0" role="button" onclick="${isAnswered ? "" : `selectAnswer(${index})`}">${option}</div>`;
        });
        html += "</div>";

        if (isAnswered) {
          const isCorrect =
            selectedAnswers[currentQuestion] === question.correct;
          html += `<div class="feedback ${isCorrect ? "correct" : "incorrect"}"><strong>${isCorrect ? "✓ Corretto!" : "✗ Sbagliato."}</strong><p>${question.explanation}</p></div>`;
        }
        html += "</div>";
        quizContent.innerHTML = html;
        document
          .getElementById("prevBtn")
          .classList.toggle("hidden", currentQuestion === 0);
        document.getElementById("nextBtn").textContent =
          currentQuestion === quizQuestions.length - 1
            ? "Vedi Risultati"
            : "Successiva →";
        document.getElementById("restartBtn").classList.add("hidden");
      }

      function selectAnswer(index) {
        if (selectedAnswers[currentQuestion] !== null) return;
        selectedAnswers[currentQuestion] = index;
        if (index === quizQuestions[currentQuestion].correct) score++;
        answeredQuestions++;
        renderQuestion();
      }

      function nextQuestion() {
        if (selectedAnswers[currentQuestion] === null)
          return alert("Per favore, seleziona una risposta.");
        if (currentQuestion < quizQuestions.length - 1) {
          currentQuestion++;
          renderQuestion();
        } else showResults();
      }

      function previousQuestion() {
        if (currentQuestion > 0) {
          currentQuestion--;
          renderQuestion();
        }
      }

      function showResults() {
        const quizContent = document.getElementById("quizContent");
        const percentage = Math.round((score / quizQuestions.length) * 100);
        quizContent.innerHTML = `<div class="results-summary"><h2>Risultati</h2><div class="score">${percentage}%</div><p>Risposte corrette: ${score}/${quizQuestions.length}</p></div>`;
        document.getElementById("prevBtn").classList.add("hidden");
        document.getElementById("nextBtn").classList.add("hidden");
        document.getElementById("restartBtn").classList.remove("hidden");
      }

      function restartQuiz() {
        currentQuestion = 0;
        score = 0;
        answeredQuestions = 0;
        selectedAnswers.fill(null);
        document.getElementById("nextBtn").classList.remove("hidden");
        renderQuestion();
      }

      // --- 3. SUSTAINABILITY SIMULATOR ---
      let gaugeChart = null;

      function initSustainabilitySimulator() {
        ["employment", "productivity", "retirement", "fertility"].forEach(
          (type) => {
            const slider = document.getElementById(`${type}Slider`);
            if (slider) {
              slider.addEventListener("input", function () {
                document.getElementById(`${type}Value`).textContent =
                  this.value +
                  (type === "fertility"
                    ? ""
                    : type === "retirement"
                      ? " anni"
                      : "%");
                updateSustainability();
              });
            }
          },
        );
        updateSustainability();
      }

      function updateSustainability() {
        const employment = parseFloat(
          document.getElementById("employmentSlider").value,
        );
        const productivity = parseFloat(
          document.getElementById("productivitySlider").value,
        );
        const retirement = parseFloat(
          document.getElementById("retirementSlider").value,
        );
        const fertility = parseFloat(
          document.getElementById("fertilitySlider").value,
        );

        const baseRatio = 1.43;
        const employmentEffect = employment / 61.5;
        const retirementEffect = (retirement - 67) * 0.08 + 1;
        const fertilityEffect = (fertility - 1.24) * 0.15 + 1;
        const productivityBonus = (productivity - 0.5) * 0.2;

        const sustainabilityRatio = (
          baseRatio * employmentEffect * retirementEffect * fertilityEffect +
          productivityBonus
        ).toFixed(2);

        let spending = 16.2 + (1.43 / sustainabilityRatio - 1) * 10;
        spending = Math.max(10, Math.min(22, spending));

        let health = "CRITICO";
        let healthColor = "#FF0000";
        if (sustainabilityRatio >= 1.9) {
          health = "OTTIMO";
          healthColor = "#90EE90";
        } else if (sustainabilityRatio >= 1.6) {
          health = "BUONO";
          healthColor = "#FFD958";
        } else if (sustainabilityRatio >= 1.4) {
          health = "ACCETTABILE";
          healthColor = "#FFA500";
        }

        document.getElementById("sustainabilityRatio").textContent =
          sustainabilityRatio;
        document.getElementById("spendingPct").textContent =
          spending.toFixed(1) + "%";
        const healthEl = document.getElementById("systemHealth");
        healthEl.textContent = health;
        healthEl.style.color = healthColor;

        updateGaugeChart(sustainabilityRatio);
      }

      function updateGaugeChart(ratio) {
        const ctx = document.getElementById("gaugeChart");
        if (!ctx) return;
        if (gaugeChart) gaugeChart.destroy();
        const percentage = Math.max(
          0,
          Math.min(100, ((ratio - 1.0) / 1.5) * 100),
        );
        gaugeChart = new Chart(ctx, {
          type: "doughnut",
          data: {
            datasets: [
              {
                data: [percentage, 100 - percentage],
                backgroundColor: [
                  percentage < 33
                    ? "#FF0000"
                    : percentage < 66
                      ? "#FFD958"
                      : "#90EE90",
                  "#E0E0E0",
                ],
                borderWidth: 0,
              },
            ],
          },
          options: {
            circumference: 180,
            rotation: 270,
            cutout: "70%",
            responsive: true,
            plugins: {
              tooltip: { enabled: false },
              legend: { display: false },
            },
          },
        });
      }

      function resetSustainability() {
        document.getElementById("employmentSlider").value = 61.5;
        document.getElementById("employmentValue").textContent = "61.5%";
        document.getElementById("productivitySlider").value = 0.5;
        document.getElementById("productivityValue").textContent = "0.5%";
        document.getElementById("retirementSlider").value = 67;
        document.getElementById("retirementValue").textContent = "67 anni";
        document.getElementById("fertilitySlider").value = 1.24;
        document.getElementById("fertilityValue").textContent = "1.24";
        updateSustainability();
      }

      // --- 4. CHARTS ---
      function initDemographicPyramids() {
        createPyramid("pyramid2024", pensionData.demographic_pyramid_2024);
        createPyramid("pyramid2070", pensionData.demographic_pyramid_2070);
      }

      function createPyramid(canvasId, data) {
        const ctx = document.getElementById(canvasId);
        if (!ctx) return;
        new Chart(ctx, {
          type: "bar",
          data: {
            labels: data.age_groups,
            datasets: [
              {
                label: "Uomini",
                data: data.males.map((v) => -v),
                backgroundColor: "#000000",
                barPercentage: 1.0,
                categoryPercentage: 1.0,
              },
              {
                label: "Donne",
                data: data.females,
                backgroundColor: "#FFD958",
                barPercentage: 1.0,
                categoryPercentage: 1.0,
              },
            ],
          },
          options: {
            indexAxis: "y",
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { position: "bottom" },
              tooltip: {
                callbacks: {
                  label: (c) => `${c.dataset.label}: ${Math.abs(c.raw)}M`,
                },
              },
            },
            scales: {
              x: {
                ticks: { callback: (v) => Math.abs(v) },
                grid: { color: "#f0f0f0" },
                suggestedMin: -3,
                suggestedMax: 3,
              },
              y: { grid: { display: false }, stacked: true },
            },
          },
        });
      }

      function initProjectionsChart() {
        const ctx = document.getElementById("projectionsChart");
        if (!ctx) return;
        new Chart(ctx, {
          type: "line",
          data: {
            labels: pensionData.spending_projections.years,
            datasets: [
              {
                label: "Scenario Attuale (RGS)",
                data: pensionData.spending_projections.rgs_scenario,
                borderColor: "#000000",
                borderWidth: 3,
                tension: 0.3,
                pointRadius: 4,
              },
              {
                label: "Scenario Pessimistico (AWG)",
                data: pensionData.spending_projections.awg_scenario,
                borderColor: "#FF0000",
                borderWidth: 2,
                borderDash: [5, 5],
                tension: 0.3,
                pointRadius: 0,
              },
              {
                label: "Scenario Ottimistico",
                data: pensionData.spending_projections.optimistic_scenario,
                borderColor: "#FFD958",
                borderWidth: 3,
                tension: 0.3,
                pointRadius: 0,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              tooltip: { mode: "index", intersect: false },
              legend: { position: "top" },
            },
            scales: {
              y: {
                title: { display: true, text: "Spesa (% PIL)" },
                min: 12,
                max: 19,
              },
            },
          },
        });
      }

      // --- INIT ---
      document.addEventListener("DOMContentLoaded", function () {
        initQuiz();
        initSustainabilitySimulator();
        initDemographicPyramids();
        initProjectionsChart();
      });
    </script>
  </body>
</html>
